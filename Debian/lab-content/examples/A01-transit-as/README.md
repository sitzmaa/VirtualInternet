# Transit AS

In this example, we introduce a transit autonomous system, which provides
transit service to other ASes. `AS150` serves as the transit AS for `AS151` and
`AS152`. Most part of this example is the same as that in the 
`00-simple-peering` example, so we will not repeat all the explanation. 


## Create layers

In this setup, in addition to the layers created in the `00-simple-peering` example, 
we add two new layers: 

- The `Ibgp` layer: automatically sets up full-mesh iBGP peering between all routers within an autonomous system.
- The `Ospf` layer: automatically sets up OSPF routing on all routers within an autonomous system.



## Create a transit autonomous system

A transit AS peers with other ASes at multiple internet exchange points, so it can
pull traffic from one place to another. To connect the BGP routers at these 
different locations, a transit AS typically has multiple internal networks. 


### 1. Create AS150 and its internal networks

In our emulator, we create three internal networks for `AS150`. 

```python
as150 = base.createAutonomousSystem(150)
as150.createNetwork('net0')
as150.createNetwork('net1')
as150.createNetwork('net2')
```

### 2. Create routers 

We create four routers. The routers `r1` and `r4` are edge routers, and 
they are BGP routers, so they, on one end, connect to the network inside 
an Internet exchange, and on the other end, connect to an internal network.
The other two internal routers `r2` and `r3` provide a path from
the edge routers, so traffic from one IX can be routed to the other IX
via the internal networks. 


```python
as150.createRouter('r1').joinNetwork('net0').joinNetwork('ix100')
as150.createRouter('r2').joinNetwork('net0').joinNetwork('net1')
as150.createRouter('r3').joinNetwork('net1').joinNetwork('net2')
as150.createRouter('r4').joinNetwork('net2').joinNetwork('ix101')
```

### Note:

In this particular example, we used OSPF and IBGP for internal routing. IBGP
and OSPF layers do not need to be configured explicitly; they are by default
enabled on all autonomous systems.  The default behaviors are as follow (see
[this manual](/docs/user_manual/manual.md#transit-as-network) if you want to customize
the behaviors):

- IBGP is configured between all routers within an autonomous system,
- OSPF is enabled on all networks that have two or more routers in them.
- Passive OSPF is enabled on all other connected networks.


## Set up BGP peering

We use private peering to peer the transit `AS150` with the two stub 
`AS151` and `AS152`. The peering relationship is `Provider`, i.e.,
`AS150` is the stub ASes' internet service provider. 
See [this manual](/docs/user_manual/bgp_peering.md) for the 
detailed explanation of BGP peering.

```python
ebgp.addPrivatePeering(100, 150, 151, abRelationship = PeerRelationship.Provider)
ebgp.addPrivatePeering(101, 150, 152, abRelationship = PeerRelationship.Provider)
```


## Save the Emulation as a Component 

This example also demonstrates that we can export the entire emulation 
in a file, so it can be loaded into other emulation. This is called
component, which is different from the files generated by the compilation. 
We will use this component in other examples. 

```
emu.dump('base-component.bin')
```

It should be noted that `dump()` must be called before the `render()`.  

